"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),s=require("sanity/router"),o=require("styled-components"),a=require("./index-tNzCvpGJ.cjs"),c=require("sanity/desk"),l=require("react-fast-compare"),d=require("@sanity/groq-store"),u=require("mendoza"),p=require("@sanity/icons"),f=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),m=require("lodash.isequal"),v=require("@sanity/preview-url-secret/create-secret"),g=require("@sanity/preview-url-secret/define-preview-url"),x=require("suspend-react");function w(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=w(o),b=w(l),j=w(m);let S;const k=new Uint8Array(16);function C(){if(!S&&(S="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!S))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return S(k)}const P=[];for(let e=0;e<256;++e)P.push((e+256).toString(16).slice(1));var E={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function I(e,t,n){if(E.randomUUID&&!t&&!e)return E.randomUUID();const r=(e=e||{}).random||(e.rng||C)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return P[e[t+0]]+P[e[t+1]]+P[e[t+2]]+P[e[t+3]]+"-"+P[e[t+4]]+P[e[t+5]]+"-"+P[e[t+6]]+P[e[t+7]]+"-"+P[e[t+8]]+P[e[t+9]]+"-"+P[e[t+10]]+P[e[t+11]]+P[e[t+12]]+P[e[t+13]]+P[e[t+14]]+P[e[t+15]]}(r)}const M=1e3,D=1e3,z=500,T=["handshake/syn","handshake/syn-ack","handshake/ack"],_=e=>T.some((t=>t===e));function L(e){const t=e.frame.contentWindow,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(_(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const s=t=>{const{data:r}=t;if(!_(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),d(t,"channel/response",{responseTo:r.id},!1)}}};function o(t){if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.frameOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function a(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,a(t),function(e){e.id=I(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),z)}(t)):"connected"===n?(t.handler=s,r(t),function(e){if(a(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:D;e.heartbeat=window.setInterval((()=>{d(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{d(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),a(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:I(),to:n.config.id,type:r};try{t?.postMessage(s,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${s.id}' on '${e.id}'`)}}function d(n,r,i,s=!0){const o=I();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const a={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:o,to:n.config.id,type:r};if(s){const t=setTimeout((()=>{a.connectionId===n.id&&(window.removeEventListener("message",s,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${a.type}' on client '${e.id}' (ID: '${a.id}').`))}),M),s=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===a.id&&(window.removeEventListener("message",s,!1),clearTimeout(t))};window.addEventListener("message",s,!1)}try{t?.postMessage(a,{targetOrigin:e.frameOrigin})}catch(t){throw new Error(`Failed to postMessage '${a.id}' on client '${e.id}'`)}}return window.addEventListener("message",o,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(d(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",o,!1),n.forEach((e=>{a(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");d(i,t,r)}))}}}function R(e){return null!==e&&Array.isArray(e)}const $=/^([A-Za-z]+):([0-9]+)$/,U=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,O=/^([A-Za-z]+):([a-z0-9]+)$/;function F(e){const t=[];for(const n of e.split(".")){const e=$.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=U.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=O.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}const q={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function B(e,t){return e.every((e=>q[e]?t[q[e]]:t.key===e.toUpperCase()))}function N(e){return"Alt"===e.key}function W(t){const{children:r,message:i,onRetry:s,onContinueAnyway:o,...a}=t,c=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:s,text:"Retry"}),l=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:o,text:"Continue anyway"});return e.jsx(n.Card,{height:"fill",...a,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,s&&o?e.jsxs(n.Inline,{space:2,children:[c,l]}):s?e.jsx(n.Box,{children:c}):o?e.jsx(n.Box,{children:l}):null]})})})})}function A(){const e=r.useContext(a.P);if(!e)throw new Error("Presentation context is missing");return e}function K(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const J=r.forwardRef((function(t,n){const{deskParams:r,params:i}=A();return e.jsx(s.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),V=r.forwardRef((function(t,n){const{documentId:r,documentType:i,...o}=t;return e.jsx(s.StateLink,{...o,ref:n,state:{path:r,type:i},title:void 0})}));function G(t){const{children:n,params:o,onDeskParams:a,previewUrl:l,refs:d}=t,{state:u,resolvePathFromState:p}=s.useRouter(),f=i.useUnique(Object.fromEntries(u._searchParams||[])),h=r.useCallback((e=>`${p(u)}${K({...f,...e})}`),[p,f,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:o,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,o=d?.find((e=>i.getPublishedId(e._id)===n));return o?e.jsx(s.StateLink,{...r,state:{path:o._id,type:o._type,_searchParams:Object.entries({preview:l})}}):e.jsx("div",{...r})},BackLink:J,ReferenceChildLink:V,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{a({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,a,o,l,d]);return e.jsx(c.PaneRouterContext.Provider,{value:m,children:n})}const Q=y.default(c.PaneLayout)`
  height: 100%;
`,H=y.default(n.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,X=y.default(n.Code)`
  white-space: pre-wrap;
`;function Z(t){const{onDeskParams:i,previewUrl:s,refs:o}=t,{devMode:a}=A(),l=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:o.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[o]),[d,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),f=r.useMemo((()=>({})),[]);return r.useEffect((()=>u(null)),[o]),d?e.jsx(W,{flex:1,message:"Could not render the document list",onRetry:p,children:a&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(X,{size:1,children:d.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(Q,{children:e.jsx(c.DeskToolProvider,{children:e.jsx(G,{params:f,onDeskParams:i,previewUrl:s,refs:o,children:e.jsx(H,{direction:"column",flex:1,children:e.jsx(c.DocumentListPane,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}function Y(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e.jsx(Z,{onDeskParams:n,previewUrl:r,refs:i})}const ee=y.default(n.Code)`
  white-space: pre-wrap;
`;function te(t){const{documentId:i,documentType:s,params:o,onDeskParams:a,onFocusPath:l}=t,{devMode:d}=A(),u=r.useMemo((()=>({id:i,options:{id:i,type:s},title:"",type:"document"})),[i,s]),[p,f]=r.useState(null),h=r.useCallback((()=>f(null)),[]);r.useEffect((()=>{f(null)}),[i,s,o]);const{setLayoutCollapsed:m}=c.useDeskTool(),v=r.useCallback((()=>m(!0)),[m]),g=r.useCallback((()=>m(!1)),[m]);return p?e.jsx(W,{flex:1,message:"Could not render the document editor",onRetry:h,children:d&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(ee,{size:1,children:p.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:f,children:e.jsx(c.PaneLayout,{style:{height:"100%"},onExpand:g,onCollapse:v,children:e.jsx(G,{onDeskParams:a,params:o,children:e.jsx(c.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:l})})})})}function ne(t){const{deskParams:n,documentId:s,documentType:o,onDeskParams:a,onFocusPath:l,onDocumentChange:d}=t,u=i.useEditState(s,o),p=u.draft||u.published;r.useEffect((()=>d(p)),[p,d]);const f=r.useCallback((e=>{p?._id&&l(p._id,e)}),[p,l]);return e.jsx(c.DeskToolProvider,{children:e.jsx(te,{documentId:s,documentType:o,params:n,onDeskParams:a,onFocusPath:f})})}function re(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:s,onFocusPath:o,onDocumentChange:a,previewUrl:c,refs:l}=t;return r&&i?e.jsx(ne,{deskParams:n,documentId:r,documentType:i,onDeskParams:s,onFocusPath:o,onDocumentChange:a}):e.jsx(Y,{onDeskParams:s,previewUrl:c,refs:l})}function ie(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}const se=r.createContext(null);r.createContext(null);const oe=r.createContext(!1);let ae=!1;function ce(e,n,r,i,s,o){if("raw"===s)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return t.applySourceDocuments(i,o,(t=>{if(t._projectId)return void(ae||(console.warn("Cross dataset references are not supported yet, ignoring source document",t),ae=!0));if(e?._id===t._id&&e?._type===t._type)return e;const i=d.unstable__getDocumentCacheKey({projectId:n,dataset:r,perspective:s},t);return d.unstable__documentsCache.get(i)}))}function le(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const de=r.memo((function(t){const{liveDocument:n,children:i,client:s,refreshInterval:o=2e3,perspective:a}=t;if("raw"===a)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,l]=r.useState([]),[d]=r.useState((()=>new Map)),u=function(e){const[t]=r.useState((()=>new Map)),n=r.useCallback(((n,r,i,s,o)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:s,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const a=t.get(n);if(!a||!a.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=a;return c.add(o),()=>{c.delete(o),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return r.useMemo((()=>({cache:t,subscribe:n})),[t,n])}(l),[p]=r.useState((()=>function(e,t,n){const r=le(a,t,n);return{subscribe:e=>{const i=u.subscribe(r,a,t,n,e);return()=>i()},getSnapshot:()=>d.get(r)}})),[f,h]=r.useState([]),m=r.useCallback((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);h((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return e.jsxs(se.Provider,{value:p,children:[e.jsx(oe.Provider,{value:!0,children:i}),e.jsx(fe,{liveDocument:n,cache:u.cache,client:s,setTurboIds:h,snapshots:d,turboIds:f,perspective:a}),c.map((t=>{if(!u.cache.has(t))return null;const{query:r,params:i,listeners:c}=u.cache.get(t);return e.jsx(pe,{liveDocument:n,client:s,listeners:c,params:i,query:r,refreshInterval:o,snapshots:d,turboIdsFromSourceMap:m,perspective:a},t)}))]})}));de.displayName="LiveStoreProvider";var ue=de;const pe=r.memo((function(e){const{liveDocument:t,client:n,refreshInterval:i,query:s,params:o,listeners:a,snapshots:c,turboIdsFromSourceMap:l,perspective:d}=e,{projectId:u,dataset:p}=r.useMemo((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[f,h]=r.useState(null);if(f)throw f;const[m,v]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=r.useState(!1);r.useEffect((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=r.useSyncExternalStore(ie,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[i,s]=r.useState("hit"),o=r.useCallback((()=>(s("inflight"),()=>s("hit"))),[]);return r.useEffect((()=>{if(!t||"hit"!==i)return;const e=setTimeout((()=>s("stale")),t);return()=>clearTimeout(e)}),[t,i]),r.useEffect((()=>{if("hit"!==i)return;const e=()=>s("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,i]),r.useEffect((()=>{n&&"hit"===i&&s("stale"),n||"stale"!==i||s("refresh")}),[n,i]),[i,o]}({refreshInterval:i}),g="refresh"===m||"inflight"===m;return r.useEffect((()=>{if(!g)return;let e=!1;const r=new AbortController;const i=v();return async function(){const{signal:i}=r,{result:f,resultSourceMap:h}=await n.fetch(s,o,{tag:"presentation-loader",signal:i,perspective:d,filterResponse:!1});if(!i.aborted){c.set(le(d,s,o),{result:h?ce(t,u,p,f,d,h):f,resultSourceMap:h}),h&&l(h);for(const e of a.values())e();e=!0}}().catch((e=>{"AbortError"!==e.name&&h(e)})).finally(i),()=>{e||r.abort()}}),[t,n,p,a,o,u,s,g,c,v,l,d]),null}));pe.displayName="QuerySubscription";const fe=r.memo((function(t){const{liveDocument:n,client:i,snapshots:s,cache:o,turboIds:a,setTurboIds:c,perspective:l}=t,{projectId:p,dataset:f}=r.useMemo((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);r.useEffect((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of o.values()){const i=le(t,n,r),o=s.get(i);if(o&&o.resultSourceMap?.documents?.length)for(const{_id:t}of o.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(a)!==JSON.stringify(t)&&c(t)}),[o,c,s,a]);const[h,m]=r.useState([]);r.useEffect((()=>{const e=new Set(h.flat()),t=new Set;for(const n of a)e.has(n)||d.unstable__documentsCache.has(d.unstable__getDocumentCacheKey({projectId:p,dataset:f,perspective:l},{_id:n}))||t.add(n);const n=[...t].slice(0,10);0!==n.length&&m((e=>[...e.slice(-10),n]))}),[h,f,l,p,a]);const[v,g]=r.useState();r.useEffect((()=>{const e=i.listen("published"===l?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=d.unstable__getDocumentCacheKey({projectId:p,dataset:f,perspective:l},{_id:e.documentId}),n=d.unstable__documentsCache.peek(t);if(n){const r={...n};delete r._rev;const i=u.applyPatch(r,e.effects.apply);d.unstable__documentsCache.set(t,i)}g(e.documentId)}));return()=>e.unsubscribe()}),[i,f,l,p]),r.useEffect((()=>{if(!v||!a.includes(v))return;const e=[];for(const[t,r]of s.entries())r.resultSourceMap?.documents?.length&&(r.result=ce(n,p,f,r.result,l,r.resultSourceMap),e.push(t));for(const t of e){const e=o.get(t)?.listeners;if(e)for(const t of e)t()}g(void 0)}),[n,o,f,v,l,p,s,a]);const[x,w]=r.useState();return r.useEffect((()=>{if(!x)return;const e=[];for(const[t,r]of s.entries())r.resultSourceMap?.documents?.length&&(r.result=ce(n,p,f,r.result,l,r.resultSourceMap),e.push(t));for(const t of e){const e=o.get(t)?.listeners;if(e)for(const t of e)t()}}),[o,f,n,x,l,p,s]),r.useEffect((()=>{n&&w(n._rev)}),[n]),e.jsx(e.Fragment,{children:h.map((t=>e.jsx(he,{client:i,projectId:p,dataset:f,ids:t,perspective:l},JSON.stringify(t))))})}));fe.displayName="Turbo";const he=r.memo((function(e){const{client:t,projectId:n,dataset:i,ids:s,perspective:o}=e;return r.useEffect((()=>{const e=s.filter((e=>!d.unstable__documentsCache.has(d.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:o},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&d.unstable__documentsCache.set(d.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:o},t),t)}),console.error)}),[t,i,s,o,n]),null}));function me(e,t,n){const i=r.useContext(se);if(!i)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const s=function(e){const t=r.useMemo((()=>JSON.stringify(e||{})),[e]);return r.useMemo((()=>JSON.parse(t)),[t])}(n),o=r.useMemo((()=>i(e,t,s)),[i,e,s,t]),[a]=r.useState((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),c=r.useCallback((()=>a),[a]);return r.useSyncExternalStore(o.subscribe,o.getSnapshot,c)}function ve(t){const{activePerspective:n,liveDocument:s,channel:o,perspective:a,liveQueries:c}=t,l=i.useClient({apiVersion:"2023-10-16"}),d=r.useMemo((()=>l.config()),[l]),u=r.useMemo((()=>l.withConfig({perspective:a,resultSourceMap:"withKeyArraySelector"})),[a,l]);return r.useEffect((()=>{if(o&&n){const{projectId:e,dataset:t}=d;o.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:a})}}),[n,o,d,a]),e.jsx(ue,{liveDocument:s,client:u,perspective:a,refreshInterval:n?2e3:0,children:Object.entries(c).map((([t,{query:n,params:r}])=>e.jsx(ge,{projectId:d.projectId,dataset:d.dataset,perspective:a,query:n,params:r,channel:o},`${t}${a}`)))})}function ge(e){const{projectId:t,dataset:n,perspective:i,query:s,params:o,channel:a}=e,c=me(null,s,o),l=r.useRef(c?.result),d=r.useRef(c?.resultSourceMap),u=c?.result,p=c?.resultSourceMap;return r.useEffect((()=>{!p||b.default(l.current,u)||b.default(d.current,p)||(a.send("loaders","loader/query-change",{projectId:t,dataset:n,perspective:i,query:s,params:o,result:u,resultSourceMap:p}),l.current=u,d.current=p)}),[a,n,o,i,t,s,u,p]),null}he.displayName="GetDocuments";const xe=r.createContext(null);xe.displayName="PanelsContext";const we=y.default.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,ye=function({children:t,defaultSize:n=null,id:i,minWidth:s,maxWidth:o,order:a=0}){const c=r.useContext(xe);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:d,unregisterElement:u}=c,p=l(i);return r.useLayoutEffect((()=>(d(i,{id:i,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:s??0,order:a}),()=>{u(i)})),[i,n,a,o,s,d,u]),e.jsx(we,{style:p,children:t})};const be=y.default.div`
  position: relative;
`,je=y.default.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-shadow-outline-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Se=function({id:t,order:n,disabled:i=!1}){const s=r.useRef(null),o=r.useContext(xe);if(null===o)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(e){return r.useRef(e||I()).current}(t),{activeResizer:c,drag:l,startDragging:d,stopDragging:u,registerElement:p,unregisterElement:f}=o,h=c===a;if(null===o)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{d(a,e.nativeEvent)}),[a,d]),v=r.useCallback((e=>{l(a,e)}),[a,l]),g=r.useCallback((()=>{s.current.blur(),u()}),[u]);return r.useEffect((()=>{if(h&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,h,v,g]),r.useLayoutEffect((()=>(p(a,{id:a,order:n,type:"resizer",el:s}),()=>{f(a)})),[a,n,p,f]),e.jsx(be,{onMouseDown:m,ref:s,children:e.jsxs(je,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function ke(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Ce="presentation/panels",Pe=()=>JSON.parse(localStorage.getItem(Ce)||"{}"),Ee=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Ie(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Ce,JSON.stringify(e))})({...Pe(),[Ee(e)]:t})};return{get:e=>Pe()[Ee(e)],set:e,setDebounced:ke(e,100)}}),[])}function Me(e,t,n){const{maxWidth:r,minWidth:i}=e,s=null==r?100:r/n*100,o=i/n*100;return Math.min(s,Math.max(o,t))}function De(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function ze(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Te(e){return"panel"===e.type}function _e(e){return"resizer"===e.type}function Le(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function Re(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let s=0;for(let t=0;t<e.length;t++){const r=e[t],o=i[t],a=Me(r,o,n);o!=a&&(s+=o-a,i[t]=a)}if("0.000"!==s.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:o,minWidth:a}=r;a=a/n*100,null!=o&&(o=o/n*100);const c=Math.min(null!=o?o:100,Math.max(a,i[t]+s));if(c!==i[t]&&(s-=c-i[t],i[t]=c,"0.000"===Math.abs(s).toFixed(3)))break}return i}const $e=y.default.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Ue=function({children:t}){const n=r.useRef(null),[i,s]=r.useState(new Map),o=r.useMemo((()=>Le(i).filter(Te)),[i]),[a,c]=r.useState([]),[l,d]=r.useState(null),u=r.useRef({elements:i,panels:o,widths:a}),p=r.useCallback((e=>({flexGrow:De(o,e,a),pointerEvents:null===l?void 0:"none"})),[l,o,a]),f=r.useCallback(((e,t)=>{s((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=r.useCallback((e=>{s((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=Le(i),r=n.findIndex((t=>t.id===e)),s=i.get(e);if(!s||!_e(s))return;const o=s.el.current;o&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>Te(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Te(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:ze(t,o),resizerRect:o.getBoundingClientRect(),widths:u.current.widths},d(e))}),[i]),g=r.useCallback((()=>{d(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:s,panelBefore:o,panelAfter:a,resizerRect:l}=m.current;if(null==o||null==a)return;const d=i.get(e);if(!d||!_e(d))return;const p=d.el.current;if(!p)return;const f=ze(t,p,s,l);if(0===f)return;const{widths:h}=u.current,v=function(e,t,n,r,i,s){const{panels:o,widths:a}=i,{widths:c}=s,l=c||a,d=[...l];{const i=e<0?r:n,s=l[o.findIndex((e=>e.id===i.id))],a=Me(i,s+Math.abs(e),t);if(s===a)return l;e=e<0?s-a:a-s}let u=0,p=e<0?n:r,f=o.findIndex((e=>e.id===p.id));for(;;){const n=o[f],r=l[f],i=Me(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,d[f]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=o.length)break}return 0===u?l:(p=e<0?r:n,f=o.findIndex((e=>e.id===p.id)),d[f]=l[f]+u,d)}(f/n.current.getBoundingClientRect().width*100,r,o,a,u.current,m.current),g=h.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=o,u.current.widths=a}),[i,o,a]);const w=Ie();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===o.length)return;const t=w.get(o);if(t){const e=Re(o,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);c(n)}),[w,o]),r.useEffect((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=Re(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=r.useMemo((()=>({activeResizer:l,drag:x,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[l,x,p,f,v,g,h]);return e.jsx(xe.Provider,{value:y,children:e.jsx($e,{ref:n,children:t})})};function Oe(e){const{id:t,type:n}=e;return i.useEditState(t,n),null}const Fe=function(t){const{children:n,setParams:i}=t,s=r.useCallback((e=>{i({preview:e})}),[i]),o=r.useMemo((()=>s),[s]);return e.jsx(a.a.Provider,{value:o,children:n})},qe=function(t){const{children:n,params:i}=t,s=r.useMemo((()=>i),[i]);return e.jsx(a.b.Provider,{value:s,children:n})},Be=function(t){const{children:n,deskParams:i,devMode:s,name:o,params:c,setParams:l}=t,d=r.useMemo((()=>({deskParams:i,devMode:s,name:o,params:c,setParams:l})),[i,s,o,c,l]);return e.jsx(a.P.Provider,{value:d,children:n})},Ne=h.motion(y.default.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),We=function(t){const{basePath:s="/"}=i.useActiveWorkspace()?.activeWorkspace||{},{fontSize:o=1,onChange:a,origin:c,padding:l=3,value:d}=t,u=r.useRef(null),[f,h]=r.useState(void 0),[m,v]=r.useState(void 0),g=r.useCallback((e=>{h(e.currentTarget.value)}),[]),x=r.useCallback((e=>{if("Enter"===e.key){if(void 0===f)return;const e=f.startsWith("/")||""===f?`${c}${f}`:f;if(!e.startsWith(c+"/")&&e!==c)return void v(`URL must start with ${c}`);if(!c&&(e.startsWith(`${s}/`)||e===s))return void v(`URL can't have the same base path as the Studio ${s}`);const t=e===c?c+"/":e;v(void 0),h(void 0),a(t.slice(c.length)),u.current?.blur()}"Escape"===e.key&&(v(void 0),h(void 0))}),[s,a,c,f]),w=r.useCallback((()=>{v(void 0),h(void 0)}),[]);r.useEffect((()=>{v(void 0),h(void 0)}),[c,d]);const y=r.useMemo((()=>({icon:p.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:m?y:void 0,customValidity:m,fontSize:o,onBlur:w,onClear:()=>{v(void 0),h(c+d)},onChange:g,onKeyDownCapture:x,padding:l,style:{zIndex:1},radius:2,ref:u,space:l,suffix:e.jsx(n.Box,{padding:1,style:{lineHeight:0,zIndex:-1},children:e.jsx(n.Button,{as:"a",fontSize:o,href:c+(f||d),icon:p.LaunchIcon,padding:l-1,mode:"bleed",rel:"noreferrer",target:"_blank"})}),value:void 0===f?`${c}${d}`:f})})},Ae=h.motion(n.Flex),Ke=y.default(n.Switch)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Je={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Ve="caution",Ge="positive",Qe={previewDrafts:p.EditIcon,published:p.PublishIcon,raw:p.DatabaseIcon},He=r.forwardRef((function(t,i){const{initialUrl:s,targetOrigin:o,navigatorEnabled:c,onPathChange:l,overlayEnabled:d,params:u,perspective:m,setPerspective:v,toggleNavigator:g,toggleOverlay:x,loadersConnection:w,overlaysConnection:y,previewKitConnection:b}=t,{devMode:j}=A(),[S,k]=r.useState("desktop"),C=n.usePrefersReducedMotion(),P=r.useCallback((()=>k("desktop")),[k]),E=r.useCallback((()=>k("mobile")),[k]),[I,M]=r.useState(!0),[D,z]=r.useState(!1),[T,_]=r.useState(!1),[L,R]=r.useState(!1),$=I||T||"connecting"===y,U=r.useMemo((()=>o===location.origin?"":o),[o]),O=r.useCallback((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${o}${u.preview||"/"}`,_(!0))}),[u.preview,o,i]),F=r.useCallback((()=>{"function"!=typeof i&&i?.current&&(i.current.src=s.toString(),_(!0))}),[i,s]),q=r.useCallback((()=>{N(!0)}),[]),[B,N]=r.useState(!1),[K,J]=r.useState(!1);r.useEffect((()=>{if(!(I||T||"connecting"!==y&&"reconnecting"!==y)){const e=setTimeout((()=>{J(!0)}),1e3);return()=>clearTimeout(e)}}),[y,I,T,J]),r.useEffect((()=>{if(!I&&!T&&K){if("connected"===y&&(R(!1),J(!1),z(!1),N(!1)),"connecting"===y){const e=setTimeout((()=>{z(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),a.M);return()=>clearTimeout(e)}if("reconnecting"===y){const e=setTimeout((()=>{z(!0),R(!0)}),a.M);return()=>clearTimeout(e)}"disconnected"===y&&R(!0)}}),[I,y,T,K]);const V=r.useMemo((()=>{const e=new URL(u.preview||"/",o),{pathname:t,search:n}=f.withoutSecretSearchParams(e);return`${t}${n}`}),[u.preview,o]),G=r.useCallback((()=>{M(!1),_(!1)}),[]);return e.jsx(h.MotionConfig,{transition:C?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[g&&e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:p.PanelLeftIcon,mode:"bleed",onClick:g,padding:3,selected:c})}),e.jsx(n.Tooltip,{content:e.jsx(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:d?"Disable edit overlay":"Enable edit overlay"})})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:d?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(Ke,{checked:d,onChange:x,disabled:$})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),j&&e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:T?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:p.RefreshIcon,mode:"bleed",loading:T,onClick:O,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(We,{onChange:l,origin:U,value:V})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:p.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:Je[m],loading:$||"connecting"===w&&"connected"!==b,disabled:"connected"!==w}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>v("previewDrafts"),padding:3,pressed:"previewDrafts"===m,tone:Ve,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Qe.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Je.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===m?1:0},children:e.jsx(p.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>v("published"),padding:3,pressed:"published"===m,tone:Ge,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Qe.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Je.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===m?1:0},children:e.jsx(p.CheckmarkIcon,{})})})]})})]}),popover:{constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:p.DesktopIcon,mode:"bleed",onClick:P,padding:3,selected:"desktop"===S})}),e.jsx(n.Tooltip,{content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:p.MobileDeviceIcon,mode:"bleed",onClick:E,padding:3,selected:"mobile"===S})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===S?0:2,sizing:"border",style:{position:"relative",cursor:$?"wait":void 0},children:[e.jsx(h.AnimatePresence,{children:L||I||T||!K||B?!I&&!$||B?L&&!B?e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:Ye,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},children:e.jsx(W,{flex:1,message:"Could not connect to the preview",onRetry:F,onContinueAnyway:q,children:j&&e.jsxs(e.Fragment,{children:["connected"!==y&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:y})]})}),"connected"!==w&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:w})]})})]})})}):null:e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:Ze,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...Xe[S]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):e.jsx(Ae,{initial:"initial",animate:"animate",exit:"exit",variants:Ze,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...Xe[S]},justify:"center",align:"center",direction:"column",gap:4,children:[D&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:D?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:D?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),D&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:q,text:"Continue anyway"})]})})}),e.jsx(Ne,{ref:i,style:{pointerEvents:$&&!B?"none":"auto",boxShadow:"0 0 0 1px var(--card-shadow-outline-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:et,animate:[!I&&!$||B?"active":"background",T?"reloading":"idle",S,K&&!B?"timedOut":""],onLoad:G})]})})]})})})),Xe={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Ze={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Ye={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},et={desktop:{...Xe.desktop,boxShadow:"0 0 0 0px var(--card-shadow-outline-color)"},mobile:{...Xe.mobile,boxShadow:"0 0 0 1px var(--card-shadow-outline-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function tt(e){if(void 0===e)return{id:void 0,path:void 0};const n=e?.split(".");return"drafts"===n[0]&&n.shift(),{id:n[0],path:n.length>1?t.studioPath.toString(F(n.slice(1).join("."))):void 0}}function nt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function rt({initialPreviewUrl:e,routerNavigate:n,routerState:i,routerSearchParams:s}){const[o,a]=r.useState((()=>{const{id:t,path:n}=tt(i.path&&decodeURIComponent(i.path));return{id:t,type:i.type,path:n,preview:s.preview||`${e.pathname}${e.search}`,perspective:s.perspective,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}})),c=r.useCallback((e=>{a((t=>{const n={...t,...e};return j.default(nt(t),nt(n))?t:n}))}),[]),l=r.useMemo((()=>nt({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]);r.useEffect((()=>{const{type:t}=i,{id:n,path:r}=tt(i.path),o=setTimeout((()=>c({id:n,type:"*"===t?void 0:t,path:r,preview:s.preview||`${e.pathname}${e.search}`,perspective:s.perspective,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment})),0);return()=>clearTimeout(o)}),[e,s,i,c]);const d=r.useMemo((()=>ke(((e,t)=>{const r=nt(e);n(r,t)}),50)),[n]),u=r.useRef(o.preview);return r.useEffect((()=>{const e=u.current;u.current=o.preview;const n=o.type,r=o.id?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?R(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(t.studioPath.fromString([o.id,o.path].filter(Boolean).join("."))):void 0,i=nt({preview:o.preview,perspective:"published"===o.perspective?"published":void 0,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),s=o.preview===e,a=setTimeout((()=>d({type:n,path:r,_searchParams:Object.entries(i)},{replace:s})),0);return()=>clearTimeout(a)}),[d,o]),{navigate:d,setParams:c,deskParams:l,params:o}}function it(e,t,n){const s=i.useClient({apiVersion:a.A}),o=i.useActiveWorkspace(),c=o?.activeWorkspace?.basePath||"/",l=function(e,t,n){const s=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,s?.id,st]),[t,s?.id,e,n])}(t,c,o?.activeWorkspace?.name||"default"),d=function(e,t){const n=i.useClient({apiVersion:a.A}),s=i.useCurrentUser(),[o,c]=r.useState(""),l=e?x.suspend((async()=>await v.createPreviewSecret(n,"@sanity/presentation","undefined"==typeof window?"":location.href,s?.id)),[...t,o]):null;return r.useEffect((()=>{if(!l)return;const e=setTimeout((()=>{r.startTransition((()=>c(l.expiresAt.toString())))}),l.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[l]),l?.secret||null}("object"==typeof e||"function"==typeof e,l);return x.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${c}/`)&&r.pathname!==c?r:t}const t="object"==typeof e?g.definePreviewUrl(e):e,r=await t({client:s,previewUrlSecret:d,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:c});return new URL(r,location.origin)}),[...l,d])}const st=Symbol();function ot(t){const{minWidth:n,maxWidth:r,component:i}=t,s=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(ye,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(Se,{order:2,disabled:s})]})}const at=y.default(n.Flex)`
  overflow-x: auto;
`;exports.default=function(o){const{previewUrl:c,components:l}=o.tool.options??{},d=o.tool.name||a.D,{unstable_navigator:u}=l||{},{navigate:p,state:f}=s.useRouter(),h=i.useUnique(Object.fromEntries(f._searchParams||[])),m=it(c||"/",d,h.preview||null),[v]=r.useState((()=>{const e=o.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),g=r.useMemo((()=>m.origin),[m.origin]),x=r.useRef(null),[w,y]=r.useState(),[b,j]=r.useState({}),{setParams:S,params:k,deskParams:C}=rt({initialPreviewUrl:m,routerNavigate:p,routerState:f,routerSearchParams:h}),[P,E]=r.useState((()=>"published"===k.perspective?k.perspective:"previewDrafts")),[I,M]=function(e){const[t,n]=r.useState((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),i=r.useCallback(((e,t)=>{n((n=>{let r=!1,i=n[e];const s=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,o=new Set;for(const e of t){const t=s(e);o.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())o.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),s=r.useMemo((()=>t[e]),[e,t]);return[r.useMemo((()=>[...s.values()]),[s]),i]}(P),[D,z]=r.useState(!0),T=!!u?.component,[_,R]=function(e,t){const[n,i]=r.useState((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",T),$=i.useProjectId(),U=i.useDataset(),O=r.useRef(),F=r.useRef(k.id),q=r.useMemo((()=>{if(T)return()=>R((e=>!e))}),[T,R]),[W,A]=r.useState((()=>I.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)})))));r.useEffect((()=>{P!==k.perspective&&S({perspective:P})}),[k.perspective,P,S]),r.useEffect((()=>{A(I.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)}))))}),[I]),r.useEffect((()=>{k.id!==F.current&&(F.current=k.id,k.id&&A((e=>e.find((e=>e._id===k.id))?e:e.slice(1).concat([{_id:k.id,_type:k.type}]))))}),[k]);const[K,J]=r.useState("connecting"),[V,G]=r.useState("connecting"),[Q,H]=r.useState("connecting");r.useEffect((()=>{const e=x.current;if(!e)return;const t=L({id:"presentation",frame:e,frameOrigin:g,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:J,onEvent(e,t){if("overlay/focus"===e&&"id"in t)S({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(O.current!==t.url){const e=void 0===O.current;O.current=t.url,S(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e&&z(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:G,onEvent(e,t){"loader/documents"===e?M(t.perspective,t.documents):"loader/query-listen"===e&&t.projectId===$&&t.dataset===U&&j((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params}};var n,r}))}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:H,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===$&&t.dataset===U&&M(t.perspective,t.documents)}}]});return y(t),()=>{t.destroy(),y(void 0)}}),[U,$,M,S,g]);const X=r.useCallback(((e,n)=>{S({path:t.studioPath.toString(n)})}),[S]),Z=r.useCallback((e=>{const t=new URL(e,m.origin),n=t.pathname+t.search;t.origin===m.origin&&n!==k.preview&&S({id:void 0,path:void 0,preview:n})}),[m,k,S]),Y=r.useCallback((e=>{S({...e})}),[S]);r.useEffect((()=>{k.id&&k.path?w?.send("overlays","presentation/focus",{id:k.id,path:k.path}):w?.send("overlays","presentation/blur",void 0)}),[w,k.id,k.path]),r.useEffect((()=>{O.current&&k.preview&&O.current!==k.preview&&(O.current=k.preview,"connected"!==K&&x.current?x.current.src=`${g}${k.preview}`:w?.send("overlays","presentation/navigate",{url:k.preview,type:"push"}))}),[w,K,g,k.preview]);const ee=r.useCallback((()=>w?.send("overlays","presentation/toggleOverlay",void 0)),[w]),[te,ne]=r.useState(null),ie=r.useCallback((e=>ne(e)),[]);return r.useEffect((()=>{const e=e=>{N(e)&&ee()},t=e=>{N(e)&&ee(),B(["mod","\\"],e)&&ee()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ee]),e.jsxs(e.Fragment,{children:[e.jsxs(Be,{deskParams:C,devMode:v,name:d,params:k,setParams:S,children:[W.map((t=>e.jsx(Oe,{id:t._id,type:t._type},t._id))),e.jsx(Fe,{setParams:S,children:e.jsx(qe,{params:k,children:e.jsx(at,{height:"fill",children:e.jsxs(Ue,{children:[T&&_&&e.jsx(ot,{...u}),e.jsx(ye,{id:"preview",minWidth:325,defaultSize:_?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",children:e.jsx(He,{initialUrl:m,navigatorEnabled:_,onPathChange:Z,overlayEnabled:D,params:k,perspective:P,ref:x,setPerspective:E,targetOrigin:g,toggleNavigator:q,toggleOverlay:ee,loadersConnection:V,overlaysConnection:K,previewKitConnection:Q})})}),e.jsx(Se,{order:4}),e.jsx(ye,{id:"content",minWidth:325,order:5,children:e.jsx(re,{refs:I,deskParams:C,documentId:k.id,documentType:k.type,onDeskParams:Y,onFocusPath:X,onDocumentChange:ie,previewUrl:k.preview})})]})})})})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{activePerspective:"published"===P,channel:w,liveQueries:b,perspective:"published",liveDocument:te?._id?.startsWith("drafts.")?null:te},"published"),e.jsx(ve,{activePerspective:"previewDrafts"===P,channel:w,liveQueries:b,perspective:"previewDrafts",liveDocument:te},"previewDrafts")]})]})};//# sourceMappingURL=PresentationTool-RHg-OvHD.cjs.map
