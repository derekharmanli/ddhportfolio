import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{createContext as i,useState as r,useEffect as o,useContext as s,useCallback as a,createElement as c,useMemo as d,useRef as l,lazy as m}from"react";import{useDocumentStore as u,useEditState as p,useConnectionState as h,unstable_useValuePreview as f,defineDocumentFieldAction as g,useWorkspace as y,pathToString as v,isRecord as T,getPublishedId as w,definePlugin as x,isDocumentSchemaType as I}from"sanity";import{ComposeIcon as b,ChevronRightIcon as P,DesktopIcon as _,InfoOutlineIcon as z,WarningOutlineIcon as S,ErrorOutlineIcon as j,MasterDetailIcon as A}from"@sanity/icons";import{Card as k,Flex as B,Box as D,Text as O,Stack as C,Heading as E}from"@sanity/ui";import{useIntentLink as H,useRouter as N,route as U}from"sanity/router";import{isObservable as $,of as L}from"rxjs";const M=b,q="presentation",F="Presentation",G=3e3,J="2023-10-16",K=i(null),Q={locations:[]};const R={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},V={positive:z,caution:S,critical:j};function W(i){const{documentId:d,options:l,schemaType:m,showPresentationTitle:p}=i,h=s(K),{message:f,locations:g,tone:y}=function(e){const{id:t,locate:n,type:i}=e,s=u(),[a,c]=r(Q);return o((()=>{if(!n)return;const e=n({id:t,type:i},{documentStore:s}),r=($(e)?e:L(e)).subscribe((e=>c(e||Q)));return()=>r.unsubscribe()}),[s,t,n,i]),a}({id:d,locate:l.locate,type:m.name}),v=g?.length||0,[T,w]=r(!1),x=a((()=>w((e=>!e))),[]),I=f||(v?t(n,{children:["Used on ",R[v]||v," ",e(n,1===v?{children:"page"}:{children:"pages"})]}):null);return 0!==v||I?e(k,{padding:1,radius:3,border:!0,tone:y,children:t("div",{style:{margin:-1},children:[!g&&t(B,{align:"flex-start",gap:3,padding:3,children:[y&&e(D,{flex:"none",children:e(O,{size:1,children:c(V[y])})}),e(D,{flex:1,children:t(O,{size:1,weight:"medium",children:[p&&t(n,{children:[l.title||F," · "]}),I]})})]}),g&&t(n,{children:[e(k,{as:"button",onClick:x,padding:3,radius:2,tone:"inherit",children:t(B,{gap:3,children:[e(D,{flex:"none",children:e(O,{size:1,children:e(P,{style:{transform:`rotate(${T?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e(D,{flex:1,children:t(O,{size:1,weight:"medium",children:[p&&t(n,{children:[l.title||F," · "]}),I]})})]})}),e(C,{hidden:!T,marginTop:1,space:1,children:g.map(((t,n)=>e(X,{active:(l.name||q)===h?.name&&t.href===h?.params.preview,documentId:d,documentType:m.name,node:t,toolName:l.name||q},n)))})]})]})}):null}function X(n){const{documentId:i,documentType:r,node:o,active:d,toolName:l}=n,m=s(K),u=m?.setParams,p=H({intent:"edit",params:{id:i,type:r,mode:"presentation",presentation:l,...m?.deskParams,preview:o.href}}),h=a((()=>{u?.({...m?.params,preview:o.href})}),[o.href,m?.params,u]);return c(k,{...m?{}:p,as:m?"button":"a",key:o.href,onClick:h,padding:3,radius:2,pressed:d,tone:"inherit"},t(B,{gap:3,children:[e(D,{flex:"none",children:e(O,{size:1,children:e(_,{})})}),t(C,{flex:1,space:2,children:[e(O,{size:1,weight:"medium",children:o.title}),e(O,{muted:!0,size:1,textOverflow:"ellipsis",children:o.href})]})]}))}function Y(n){const{documentId:i,schemaType:r}=n,o=p(i,r.name),s=h(i,r.name),a=o.draft||o.published,c=a?._id||i,{error:l,value:m,isLoading:u}=f({enabled:"connected"===s,schemaType:r,value:d((()=>({_type:"reference",_ref:c})),[c])}),g=r.title||r.name,y=m?.title;return l||u?null:t(C,{space:3,children:[g!==y&&e(O,{muted:!0,size:1,children:g}),e(E,{as:"h1",muted:!m?.title,size:3,children:m?.title||e("em",{children:"Untitled"})})]})}const Z=i(null);function ee(n){const{documentId:i,options:r,schemaType:o}=n,a=s(Z);if(a&&a.options[0]!==r)return null;const c=a?.options?.length||0;return t(C,{marginBottom:5,space:5,children:[e(Y,{documentId:i,options:r,schemaType:o}),e(C,{space:2,children:a?.options.map(((t,n)=>e(W,{documentId:i,options:t,schemaType:o,showPresentationTitle:c>1},n)))})]})}function te(t){const{children:n,options:i}=t,c=s(Z),m=c?.register,[u,p]=r((()=>[])),h=a((e=>m?m(e):(p((t=>[e].concat(t))),()=>{p((t=>t.filter((t=>t!==e))))})),[m]),f=l(h);f.current=h;const g=d((()=>({options:c?.options||u,register:h})),[u,c,h]);return o((()=>f.current(i)),[i]),e(Z.Provider,{value:g,children:n})}const ne=g({name:"presentation/openInStructure",useAction({documentId:e,documentType:t,path:n}){const i=y(),{navigateIntent:r}=N(),o=s(K),a=d((()=>function(e,t,n){const i=e.map((e=>{const i=e.canHandleIntent?.("edit",{id:t,type:n,mode:"structure"},{});return{tool:e,match:i}})),r=i.filter((e=>T(e.match)&&e.match.mode));if(r.length>0)return r[0].tool;const o=i.filter((e=>e.match));return o[0]?.tool}(i.tools,e,t)),[e,t,i.tools]);return{type:"action",hidden:!o||n.length>0||!a,icon:a?.icon||A,title:`Open in ${a?.title||"Structure"}`,onAction(){r("edit",{id:e,type:t,mode:"structure",path:v(n)})},renderAsButton:!0}}});function ie(e,t,n,i){const{id:r,mode:o,path:s,presentation:a,type:c,...d}=t;return"edit"===e&&r?{type:c||"*",path:[w(r),s].filter(Boolean).join("."),_searchParams:Object.entries(d)}:{intent:e,params:t,payload:i}}const re=U.create("/",{__unsafe_disableScopedSearchParams:!0},[U.intents("/intent"),U.create("/:type",[U.create("/:path")])]),oe=m((()=>import("./PresentationTool-AUEDKq_2.js"))),se=x((n=>{const i=n.name||q;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==ne.name)),ne]},form:{components:{input:function(i){const r=i.value,o=r?._id?w(r?._id):void 0;return I(i.schemaType)?t(te,{options:n,children:[o&&e(ee,{documentId:o,options:n,schemaType:i.schemaType}),i.renderDefault(i)]}):i.renderDefault(i)}}},tools:[{icon:n.icon||M,name:i,title:n.title,component:oe,options:n,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==i)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:ie,router:re}]}})),ae=i(null);function ce(){const e=s(ae);if(!e)throw new Error("Presentation navigate context is missing");return e}const de=i(null);function le(){const e=s(de);if(!e)throw new Error("Presentation params context is missing");return e}export{J as A,q as D,G as M,K as P,ae as a,de as b,le as c,se as p,ce as u};//# sourceMappingURL=index-O0_XKB9F.js.map
